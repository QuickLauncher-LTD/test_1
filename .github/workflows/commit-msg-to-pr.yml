name: PR Commit Messages

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  comment-commit-messages:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: Get Commit Messages
      id: get-commit-messages
      run: |
        # PR의 베이스 브랜치(예: main)와 HEAD 브랜치 간의 커밋 메시지 추출
        commit_messages=$(git log --format=%B origin/${{ github.base_ref }}..origin/${{ github.head_ref }})
        commit_messages="${commit_messages//'%'/'%25'}"
        commit_messages="${commit_messages//$'\n'/'%0A'}"
        commit_messages="${commit_messages//$'\r'/'%0D'}"
        echo "::set-output name=messages::$commit_messages"

    - name: Comment PR
      uses: thollander/actions-comment-pull-request@v1
      with:
        message: |
          ### Commit Messages
          ```
          ${{ steps.get-commit-messages.outputs.messages }}
          ```
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
