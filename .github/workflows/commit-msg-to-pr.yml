name: Update PR Description with Commit Messages

on:
  pull_request_target:
    types: [opened, reopened, synchronize]

jobs:
  update-description:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Get Commit Messages
        id: get-commit-messages
        run: |
          # PRì˜ ë² ì´ìŠ¤ ë¸Œëœì¹˜ì™€ HEAD ë¸Œëœì¹˜ ê°„ì˜ ì»¤ë°‹ ë©”ì‹œì§€ ì¶”ì¶œ
          commit_messages=$(git log --format=%B origin/${{ github.base_ref }}..origin/${{ github.head_ref }})
          commit_messages="${commit_messages//'%'/'%25'}"
          commit_messages="${commit_messages//$'\n'/'%0A'}"
          commit_messages="${commit_messages//$'\r'/'%0D'}"
          echo "::set-output name=messages::$commit_messages"

      - name: Update PR description
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # í˜„ì¬ PRì˜ ì„¤ëª…ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
          PR_DESCRIPTION=$(gh pr view ${{ github.event.pull_request.number }} --repo ${{ github.repository }} --json body -q .body)

          # ìƒˆë¡œìš´ ë‚´ìš©ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì—¬ê¸°ì— ì›í•˜ëŠ” í…ìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
          UPDATED_DESCRIPTION="${PR_DESCRIPTION}
          ---
          ### Commit Messages
          ${{ steps.get-commit-messages.outputs.messages }}

          âœ…  PR Check List
          - [x] Self code review finished
          - [x] Spotless / static analysis finished
          - [x] Module test finished
          - [x] All bugs are fixed

          ğŸ’»  ì£¼ìš” ê°œë°œ ë‚´ìš©
          [CMP-552] ì·¨ì•½ì  ì‹œí¬ë¦¿ ëŒ€ì‹œë³´ë“œ API
          - ì·¨ì•½ì  Top, ì¡°ì¹˜ìœ¨ ìš”ì²­ ì‹œ org, repo ì •ë³´ ì¿¼ë¦¬íŒŒë¼ë¯¸í„° ì…ë ¥ ì¶”ê°€

          âš™ï¸ í…ŒìŠ¤íŠ¸ ë‚´ìš© (ëª¨ë“ˆê²€ì¦)

          âš™ï¸ í…ŒìŠ¤íŠ¸ ë‚´ìš© (í†µí•©ê²€ì¦)
          - ë¡œì»¬ í†µí•© í…ŒìŠ¤íŠ¸

          â“ Known issue
          - ì—†ìŒ

          ğŸ™ To Reviewer
          - ì¿¼ë¦¬íŒŒë¼ë¯¸í„° ì…ë ¥ ì¶”ê°€ ê±´ì…ë‹ˆë‹¤. ë¡œì§ì€ ë™ì¼í•©ë‹ˆë‹¤.

          ğŸ« Ticket 
          [CMP-551]: https://lgu-cto.atlassian.net/browse/CMP-551
          [CMP-552]: https://lgu-cto.atlassian.net/browse/CMP-552"

          # PRì˜ ì„¤ëª…ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
          gh pr edit ${{ github.event.pull_request.number }} --repo ${{ github.repository }} --body "$UPDATED_DESCRIPTION"
